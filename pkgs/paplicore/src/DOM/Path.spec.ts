import { Path } from './Path'

describe('Path', () => {
  describe('getPressureAtLength', () => {
    it('works', () => {
      const p = Path.create({
        points: [
          { x: 0, y: 0, in: null, out: null, pressure: 0 },
          { x: 1, y: 0, in: null, out: null, pressure: 1 },
        ],
        closed: false,
      })

      // console.log(p.getTotalLength())
      expect(p.getPressureAt(0)).toBe(0)
      expect(p.getPressureAt(0.5)).toBe(0.5)
      expect(p.getPressureAt(1)).toBe(1)
    })
  })

  describe.only('getSequencialPointsReader', () => {
    it('Returns to same value of uncached getPoint', () => {
      const p = Path.create({
        closed: false,
        points: testComplexPoints(),
      })

      const reader = p.getSequencialPointsReader()

      const pt = reader.getPointAt(0)
      expect(pt.x).toBeCloseTo(p.getPointAt(0).x, 5)
      expect(pt.y).toBeCloseTo(p.getPointAt(0).y, 5)
      // console.log({ pt, original: p.getPointAt(0) })

      const pt2 = reader.getPointAt(0.5)
      expect(pt2.x).toBeCloseTo(p.getPointAt(0.5).x, 5)
      expect(pt2.y).toBeCloseTo(p.getPointAt(0.5).y, 5)
      // console.log({ pt2, original: p.getPointAt(0.5) })

      const pt3 = reader.getPointAt(1)
      expect(pt3.x).toBeCloseTo(p.getPointAt(1).x, 5)
      expect(pt3.y).toBeCloseTo(p.getPointAt(1).y, 5)
      // console.log({ pt2, original: p.getPointAt(0.5) })
    })
  })

  describe('getSequencialTangentsReader', () => {
    it('Returns to same value of uncached getTangent', () => {
      const p = Path.create({
        closed: false,
        points: testComplexPoints(),
      })

      const reader = p.getSequencialTangentsReader()

      const pt = reader.getTangentAt(0)
      expect(pt.x).toBeCloseTo(p.getTangentAt(0).x, 5)
      expect(pt.y).toBeCloseTo(p.getTangentAt(0).y, 5)
      expect(Number.isNaN(pt.x) && Number.isNaN(pt.y)).toBe(false)
      console.log({ pt })

      const pt2 = reader.getTangentAt(0.5)
      expect(pt2.x).toBeCloseTo(p.getTangentAt(0.5).x, 5)
      expect(pt2.y).toBeCloseTo(p.getTangentAt(0.5).y, 5)
      expect(Number.isNaN(pt2.x) && Number.isNaN(pt2.y)).toBe(false)
      console.log({ pt2 })

      const pt3 = reader.getTangentAt(1)
      expect(pt3.x).toBeCloseTo(p.getTangentAt(1).x, 5)
      expect(pt3.y).toBeCloseTo(p.getTangentAt(1).y, 5)
      expect(Number.isNaN(pt3.x) && Number.isNaN(pt3.y)).toBe(false)
      console.log({ pt2 })
    })
  })

  describe('simplify', () => {
    it('works', () => {
      const p = Path.create({
        closed: false,
        points: testComplexPoints(),
      })

      p.getSimplifiedPath()
    })
  })
})

function testComplexPoints() {
  return [
    {
      x: 328.1812744140625,
      y: 237.988525390625,
      in: null,
      out: null,
      pressure: 0.5,
    },
    {
      x: 326.93927001953125,
      y: 237.81109619140625,
      in: { x: 327.353271484375, y: 237.8883056640625 },
      out: { x: 326.5252685546875, y: 237.73388671875 },
      pressure: 0.5,
    },
    {
      x: 325.697265625,
      y: 237.5252685546875,
      in: { x: 325.9042663574219, y: 237.75028483072916 },
      out: { x: 325.4902648925781, y: 237.30025227864584 },
      pressure: 0.5,
    },
    {
      x: 325.697265625,
      y: 236.46099853515625,
      in: { x: 325.5417887369792, y: 237.17878214518228 },
      out: { x: 325.8527425130208, y: 235.74321492513022 },
      pressure: 0.5,
    },
    {
      x: 326.630126953125,
      y: 233.21856689453125,
      in: { x: 325.7582600911458, y: 234.86354064941406 },
      out: { x: 327.5019938151042, y: 231.57359313964844 },
      pressure: 0.5,
    },
    {
      x: 330.928466796875,
      y: 226.59115600585938,
      in: { x: 328.87354532877606, y: 229.0824178059896 },
      out: { x: 332.98338826497394, y: 224.09989420572916 },
      pressure: 0.5,
    },
    {
      x: 338.95965576171875,
      y: 218.27099609375,
      in: { x: 335.7637532552083, y: 220.94216918945312 },
      out: { x: 342.1555582682292, y: 215.59982299804688 },
      pressure: 0.5,
    },
    {
      x: 350.1038818359375,
      y: 210.56411743164062,
      in: { x: 346.31467692057294, y: 212.83174641927084 },
      out: { x: 353.89308675130206, y: 208.2964884440104 },
      pressure: 0.5,
    },
    {
      x: 361.69488525390625,
      y: 204.66522216796875,
      in: { x: 358.21331787109375, y: 206.3255411783854 },
      out: { x: 365.17645263671875, y: 203.0049031575521 },
      pressure: 0.5,
    },
    {
      x: 370.9932861328125,
      y: 200.60220336914062,
      in: { x: 368.24045817057294, y: 201.7906748453776 },
      out: { x: 373.74611409505206, y: 199.41373189290366 },
      pressure: 0.5,
    },
    {
      x: 378.21185302734375,
      y: 197.53439331054688,
      in: { x: 376.26381429036456, y: 198.26416015625 },
      out: { x: 380.15989176432294, y: 196.80462646484375 },
      pressure: 0.5,
    },
    {
      x: 382.6815185546875,
      y: 196.22360229492188,
      in: { x: 381.64170328776044, y: 196.4487559000651 },
      out: { x: 383.72133382161456, y: 195.99844868977866 },
      pressure: 0.5,
    },
    {
      x: 384.45074462890625,
      y: 196.1834716796875,
      in: { x: 384.2025553385417, y: 195.4386444091797 },
      out: { x: 384.6989339192708, y: 196.9282989501953 },
      pressure: 0.5,
    },
    {
      x: 384.170654296875,
      y: 200.69256591796875,
      in: { x: 385.1704813639323, y: 196.90674845377603 },
      out: { x: 383.1708272298177, y: 204.47838338216147 },
      pressure: 0.5,
    },
    {
      x: 378.4517822265625,
      y: 218.89837646484375,
      in: { x: 381.67357381184894, y: 210.27301025390625 },
      out: { x: 375.22999064127606, y: 227.52374267578125 },
      pressure: 0.5,
    },
    {
      x: 364.83990478515625,
      y: 252.44476318359375,
      in: { x: 369.4326578776042, y: 241.31236775716147 },
      out: { x: 360.2471516927083, y: 263.57715861002606 },
      pressure: 0.5,
    },
    {
      x: 350.895263671875,
      y: 285.6927490234375,
      in: { x: 354.7650553385417, y: 275.7931620279948 },
      out: { x: 347.0254720052083, y: 295.5923360188802 },
      pressure: 0.5,
    },
    {
      x: 341.62115478515625,
      y: 311.84228515625,
      in: { x: 343.9712727864583, y: 303.81561787923175 },
      out: { x: 339.2710367838542, y: 319.86895243326825 },
      pressure: 0.5,
    },
    {
      x: 336.7945556640625,
      y: 333.8527526855469,
      in: { x: 337.67713419596356, y: 327.85425821940106 },
      out: { x: 335.91197713216144, y: 339.8512471516927 },
      pressure: 0.5,
    },
    {
      x: 336.32568359375,
      y: 347.833251953125,
      in: { x: 335.69504801432294, y: 344.3927357991536 },
      out: { x: 336.95631917317706, y: 351.2737681070964 },
      pressure: 0.5,
    },
    {
      x: 340.578369140625,
      y: 354.495849609375,
      in: { x: 337.81141153971356, y: 352.80120849609375 },
      out: { x: 343.34532674153644, y: 356.19049072265625 },
      pressure: 0.5,
    },
    {
      x: 352.92742919921875,
      y: 358.0010986328125,
      in: { x: 347.80780029296875, y: 357.06238810221356 },
      out: { x: 358.04705810546875, y: 358.93980916341144 },
      pressure: 0.5,
    },
    {
      x: 371.296142578125,
      y: 360.12811279296875,
      in: { x: 365.4256998697917, y: 359.4971110026042 },
      out: { x: 377.1665852864583, y: 360.7591145833333 },
      pressure: 0.5,
    },
    {
      x: 388.15008544921875,
      y: 361.787109375,
      in: { x: 383.0278828938802, y: 360.93553670247394 },
      out: { x: 393.2722880045573, y: 362.63868204752606 },
      pressure: 0.5,
    },
    {
      x: 402.02935791015625,
      y: 365.237548828125,
      in: { x: 397.86767578125, y: 363.42279052734375 },
      out: { x: 406.1910400390625, y: 367.05230712890625 },
      pressure: 0.5,
    },
    {
      x: 413.12017822265625,
      y: 372.6756591796875,
      in: { x: 410.39014689127606, y: 369.1363118489583 },
      out: { x: 415.85020955403644, y: 376.2150065104167 },
      pressure: 0.5,
    },
    {
      x: 418.4095458984375,
      y: 386.4736328125,
      in: { x: 417.4990234375, y: 380.12514241536456 },
      out: { x: 419.320068359375, y: 392.82212320963544 },
      pressure: 0.5,
    },
    {
      x: 418.58331298828125,
      y: 410.7666015625,
      in: { x: 419.1098124186198, y: 402.5307108561198 },
      out: { x: 418.0568135579427, y: 419.0024922688802 },
      pressure: 0.5,
    },
    {
      x: 415.25054931640625,
      y: 435.88897705078125,
      in: { x: 416.47792561848956, y: 429.0027567545573 },
      out: { x: 414.02317301432294, y: 442.7751973470052 },
      pressure: 0.5,
    },
    {
      x: 411.21905517578125,
      y: 452.08392333984375,
      in: { x: 412.2347005208333, y: 447.5340881347656 },
      out: { x: 410.2034098307292, y: 456.6337585449219 },
      pressure: 0.5,
    },
    {
      x: 409.15667724609375,
      y: 463.18798828125,
      in: { x: 409.58253987630206, y: 460.09918212890625 },
      out: { x: 408.73081461588544, y: 466.27679443359375 },
      pressure: 0.5,
    },
    {
      x: 408.66387939453125,
      y: 470.61676025390625,
      in: { x: 407.8827718098958, y: 468.85992431640625 },
      out: { x: 409.4449869791667, y: 472.37359619140625 },
      pressure: 0.5,
    },
    {
      x: 413.84332275390625,
      y: 473.72900390625,
      in: { x: 411.24346923828125, y: 473.1718037923177 },
      out: { x: 416.44317626953125, y: 474.2862040201823 },
      pressure: 0.5,
    },
    {
      x: 424.26300048828125,
      y: 473.9599609375,
      in: { x: 420.5116271972656, y: 473.8322041829427 },
      out: { x: 428.0143737792969, y: 474.0877176920573 },
      pressure: 0.5,
    },
    {
      x: 436.3515625,
      y: 474.49554443359375,
      in: { x: 431.8485412597656, y: 473.43251546223956 },
      out: { x: 440.8545837402344, y: 475.55857340494794 },
      pressure: 0.5,
    },
    {
      x: 451.2811279296875,
      y: 480.338134765625,
      in: { x: 446.66404215494794, y: 477.0939432779948 },
      out: { x: 455.89821370442706, y: 483.5823262532552 },
      pressure: 0.5,
    },
    {
      x: 464.0540771484375,
      y: 493.960693359375,
      in: { x: 460.73777262369794, y: 488.358154296875 },
      out: { x: 467.37038167317706, y: 499.563232421875 },
      pressure: 0.5,
    },
    {
      x: 471.178955078125,
      y: 513.953369140625,
      in: { x: 469.4677327473958, y: 506.5510660807292 },
      out: { x: 472.8901774088542, y: 521.3556722005209 },
      pressure: 0.5,
    },
    {
      x: 474.3214111328125,
      y: 538.37451171875,
      in: { x: 473.6913655598958, y: 530.892588297526 },
      out: { x: 474.9514567057292, y: 545.856435139974 },
      pressure: 0.5,
    },
    {
      x: 474.959228515625,
      y: 558.8449096679688,
      in: { x: 474.85292561848956, y: 553.1981302897135 },
      out: { x: 475.06553141276044, y: 564.491689046224 },
      pressure: 0.5,
    },
    {
      x: 474.959228515625,
      y: 572.2551879882812,
      in: { x: 474.83343505859375, y: 568.269032796224 },
      out: { x: 475.08502197265625, y: 576.2413431803385 },
      pressure: 0.5,
    },
    {
      x: 475.7139892578125,
      y: 582.7618408203125,
      in: { x: 474.6654866536458, y: 580.1189168294271 },
      out: { x: 476.7624918619792, y: 585.4047648111979 },
      pressure: 0.5,
    },
    {
      x: 481.250244140625,
      y: 588.1127319335938,
      in: { x: 478.35072835286456, y: 587.1328938802084 },
      out: { x: 484.14975992838544, y: 589.0925699869791 },
      pressure: 0.5,
    },
    {
      x: 493.111083984375,
      y: 588.640869140625,
      in: { x: 488.4798990885417, y: 588.5528462727865 },
      out: { x: 497.7422688802083, y: 588.7288920084635 },
      pressure: 0.5,
    },
    {
      x: 509.037353515625,
      y: 588.640869140625,
      in: { x: 503.56585693359375, y: 588.2580769856771 },
      out: { x: 514.5088500976562, y: 589.0236612955729 },
      pressure: 0.5,
    },
    {
      x: 525.9400634765625,
      y: 590.9376220703125,
      in: { x: 520.8619791666666, y: 588.9426676432291 },
      out: { x: 531.0181477864584, y: 592.9325764973959 },
      pressure: 0.5,
    },
    {
      x: 539.505859375,
      y: 600.610595703125,
      in: { x: 535.7461954752604, y: 596.1406453450521 },
      out: { x: 543.2655232747396, y: 605.0805460611979 },
      pressure: 0.5,
    },
    {
      x: 548.498046875,
      y: 617.75732421875,
      in: { x: 546.2136840820312, y: 611.6788330078125 },
      out: { x: 550.7824096679688, y: 623.8358154296875 },
      pressure: 0.5,
    },
    {
      x: 553.2120361328125,
      y: 637.08154296875,
      in: { x: 552.1053670247396, y: 630.2659810384115 },
      out: { x: 554.3187052408854, y: 643.8971048990885 },
      pressure: 0.5,
    },
    {
      x: 555.1380615234375,
      y: 658.6506958007812,
      in: { x: 554.689453125, y: 651.6578572591146 },
      out: { x: 555.586669921875, y: 665.6435343424479 },
      pressure: 0.5,
    },
    {
      x: 555.9036865234375,
      y: 679.03857421875,
      in: { x: 555.7311808268229, y: 673.4961242675781 },
      out: { x: 556.0761922200521, y: 684.5810241699219 },
      pressure: 0.5,
    },
    {
      x: 556.173095703125,
      y: 691.9053955078125,
      in: { x: 555.9152425130209, y: 688.3175659179688 },
      out: { x: 556.4309488932291, y: 695.4932250976562 },
      pressure: 0.5,
    },
    {
      x: 557.4508056640625,
      y: 700.5655517578125,
      in: { x: 556.6986083984375, y: 698.1791687011719 },
      out: { x: 558.2030029296875, y: 702.9519348144531 },
      pressure: 0.5,
    },
    {
      x: 560.686279296875,
      y: 706.2236938476562,
      in: { x: 559.1930541992188, y: 704.9512227376302 },
      out: { x: 562.1795043945312, y: 707.4961649576823 },
      pressure: 0.5,
    },
    {
      x: 566.41015625,
      y: 708.2003784179688,
      in: { x: 564.0706583658854, y: 707.7852884928385 },
      out: { x: 568.7496541341146, y: 708.615468343099 },
      pressure: 0.5,
    },
    {
      x: 574.7232666015625,
      y: 708.7142333984375,
      in: { x: 571.6202596028646, y: 708.6236470540365 },
      out: { x: 577.8262736002604, y: 708.8048197428385 },
      pressure: 0.5,
    },
    {
      x: 585.0281982421875,
      y: 708.743896484375,
      in: { x: 581.315673828125, y: 708.9208374023438 },
      out: { x: 588.74072265625, y: 708.5669555664062 },
      pressure: 0.5,
    },
    {
      x: 596.9984130859375,
      y: 707.652587890625,
      in: { x: 592.3555094401041, y: 708.2889811197916 },
      out: { x: 601.6413167317709, y: 707.0161946614584 },
      pressure: 0.5,
    },
    {
      x: 612.8856201171875,
      y: 704.925537109375,
      in: { x: 607.6566975911459, y: 705.7417704264323 },
      out: { x: 618.1145426432291, y: 704.1093037923177 },
      pressure: 0.5,
    },
    {
      x: 628.3719482421875,
      y: 702.7551879882812,
      in: { x: 623.9425455729166, y: 703.2523396809896 },
      out: { x: 632.8013509114584, y: 702.2580362955729 },
      pressure: 0.5,
    },
    {
      x: 639.4620361328125,
      y: 701.942626953125,
      in: { x: 633.7657470703125, y: 702.0116271972656 },
      out: { x: 645.1583251953125, y: 701.8736267089844 },
      pressure: 0.5,
    },
    {
      x: 662.5496826171875,
      y: 702.3411865234375,
      in: { x: 658.7017415364584, y: 702.2747599283854 },
      out: null,
      pressure: 0.5,
    },
  ]
}
